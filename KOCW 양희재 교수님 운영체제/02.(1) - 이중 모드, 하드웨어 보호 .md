# 이중 모드, 하드웨어 보호

### 이중 모드 : cpu가 동작하는 모드를 2가지로 나눈 것을 의미함

- 한 컴퓨터를 여러 사람이 동시에 사용하는 환경	
    - 또는 한 사람이 여러 개의 프로그램을 동시에 사용
    - 한 사람의 고의/실수에 프로그램이 전체 영향
    	-	ex) STOP, HALT, RESET
        

- 사용자 프로그램은 STOP 등 치명적 명령 사용을 **불가하게 함!**
  - 사용자(user)모드 vs 관리자(supervisor)모드
  - 이중 모드(dual mode)
  - 관리자 모드 = 시스템 모드 = 모니터 모드 = 특권 모드

- **특권 명령**
  - STOP, HALT, RESET, SET_TIMER, SET_HW ...
- user 모드와 supervisor 모드를 구분하는 기준 : cpu안에 monitor bit를 하나두고 0이면 supervisor 모드, 1이면 user 모드임을 나타내게 한다.

&nbsp;

&nbsp;



- 이중 모드(dual mode)
  - 레지스터에 모드를 나타내는 플래그(flag)
  - 운영체제 서비스 실행될 때는 **관리자 모드**
  - 사용자 프로그램 실행될 때는 **사용자 모드**
  - 하드웨어/소프트웨어 인터럽트 발생하면 **관리자 모드**
  - 운영체제 서비스가 끝나면 다시 **사용자 모드**
  
  
  
  

- 일반적 프로그램의 실행
  - 프로그램 적재(on memory)
  - user mode -> (키보드, 마우스) -> system mode(ISR) -> user mode -> (모니터, 디스크, 프린터) -> system mode -> user mode


&nbsp;
### 하드웨어 보호

- 사용자의 잘못된 입출력 명령
  - 다른 사용자의 입출력, 정보 등에 방해
  - ex) 프린트, 혼선, 리셋 등
  - ex) 다른 사람의 파일 읽고 쓰기(하드 디스크)
  

- 해결법
  
  - **입출력 명령을 특권 명령으로 함.**  
    - ex) 입력 장치. 출력 장치를 제어하는 명령어 : IN, OUT
  
  1. 입출력을 하려면 운영체제에게 요청하고 (system mode 전환)
  2. 운영체제가 입출력 대행 : 마친 후 다시 user mode 복귀. 만약 올바른 요청이 아니면 운영체제가 거부
  
- 만약 사용자가 입출력 명령을 직접 내리면 : Privileged instruction violation

&nbsp;

### 메모리 보호
  - 다른 사용자 메모리 또는 운영체제 영역 메모리 접근
    - 우연히 또는 고의로
    - 다른 사용자 정보/프로그램에 대한 해킹
    - 운영체제 해킹
    
  - 해결법
    - MMU를 두어 다른 메모리 영역 침범 감시하도록(Memory Management Unit)
    - MMU 설정은 특권 명령임. 따라서 운영체제만 바꿀 수 있음
  - 다른 사용자 또는 운영체제 영역 메모리 접근 시도 -> Segment violation 
